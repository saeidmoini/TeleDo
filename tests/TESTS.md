# راهنمای اجرای تست‌ها (Pytest)

## پیش‌نیازها
- پایتون نصب‌شده (نسخه 3.10 یا جدیدتر پیشنهاد می‌شود)
- نصب وابستگی‌ها: `pip install -r requirements.txt`
- متغیر `DATABASE_URL` برای تست‌ها نیاز نیست؛ کانفیگ تست به صورت خودکار SQLite در حافظه را ست می‌کند.

## نحوه اجرا
در ریشه پروژه این دستور را اجرا کنید:
```bash
pytest
```
این دستور تمام تست‌های پوشه `tests/` را اجرا می‌کند.

## ساختار تست‌ها
- `tests/conftest.py`: دیتابیس SQLite در حافظه و سشن تراکنشی برای هر تست را فراهم می‌کند.
- `tests/test_user_service.py`: سناریوهای سرویس کاربران (ایجاد/به‌روزرسانی، تشخیص ادمین، حذف، فیلتر کاربران).
- `tests/test_task_service.py`: سناریوهای سرویس تسک‌ها (ایجاد/ویرایش تسک، وضعیت، گروه/تاپیک، انتساب کاربر، پیوست‌ها).
- `tests/test_utils.py`: توابع تاریخ و متون (جلالی↔︎میلادی، بارگذاری و فرمت متن‌ها).
- `tests/test_main_commands.py`: منوی دستورات بات، تفکیک اسکوپ کاربر/ادمین با BotCommandScope.

## نکات
- تست‌ها دیتابیس واقعی را لمس نمی‌کنند؛ همه‌چیز روی SQLite در حافظه اجرا می‌شود.
- اگر ماژول تازه‌ای اضافه کردید، وابستگی‌های تست (مثلاً `pytest`) باید در `requirements.txt` موجود باشند.
- در صورت نیاز به اجرای بخشی از تست‌ها:
```bash
pytest tests/test_task_service.py::test_update_status_validation
```

## عیب‌یابی سریع
- خطای عدم وجود بسته: `pip install -r requirements.txt`
- خطای ایمپورت: مطمئن شوید دستورات را از ریشه پروژه اجرا می‌کنید.
- برای خروجی جزئیات بیشتر: `pytest -vv`
